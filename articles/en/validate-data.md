# Validate data

<img src="~/images/image (10).png" alt=""><br>

When managing master data it's common to impose constraints (e.g., uniqueness, required fields).

NonNonSheet helps detect issues early via cell-level validation feedback.

```csharp
[NonNonTable]
public partial class SampleTable : NonNonTable<SampleData>, ISampleTableValidator { }

[Serializable]
public class SampleData
{
    public int Id;
    public string Name;
}
```

To enable validation, implement the generated validator interface (e.g., `ISampleTableValidator`) on the table class.

```csharp
public interface ISampleTableValidator : IValidator<SampleData>
{
  ValidationResult ValidateId(SampleData self, int id) => ValidationResult.Success();
  ValidationResult ValidateName(SampleData self, string name) => ValidationResult.Success();
}
```

`IXxxValidator` interfaces are auto-generated by SourceGenerators.

For example, defining `SampleTable` causes `ISampleTableValidator` to be generated.

This interface declares a validation method for each field in the table's data class.

Each validation method receives:

* `self`: the full data object being edited
* the new value of the edited field

It returns a `ValidationResult` indicating success or an error.

## Validation Examples

```csharp
[NonNonTable]
public partial class ValidationSampleTable : NonNonTable<ValidationSampleData>, IValidationSampleTableValidator
{
    ValidationResult IValidationSampleTableValidator.ValidateId(ValidationSampleData self, int id)
    {
        var sameIdData = Data.Where(v => v != self && v.Id == id).Cast<object>().ToArray();
        if (sameIdData.Any()) return ValidationResult.Error("duplicate ID", sameIdData);
        return ValidationResult.Success();
    }

    ValidationResult IValidationSampleTableValidator.ValidateName(ValidationSampleData self, string v)
    {
        if (string.IsNullOrEmpty(v)) return ValidationResult.Error("name must be non-empty");
        return ValidationResult.Success();
    }
}

[Serializable]
public class ValidationSampleData
{
    public int Id;
    public string Name;
}
```

Validation examples using `ValidationSampleTable`.

```csharp
ValidationResult IValidationSampleTableValidator.ValidateName(ValidationSampleData self, string v)
{
    if (string.IsNullOrEmpty(v)) return ValidationResult.Error("name must be non-empty");
    return ValidationResult.Success();
}
```

#### Example: Empty Name Check

`ValidateName` triggers an error when the `Name` field is empty.

Return `ValidationResult.Error` to indicate failure. The message you pass is shown as the cell tooltip.

<img src="~/images/image (11).png" alt=""><br>

```csharp
ValidationResult IValidationSampleTableValidator.ValidateId(ValidationSampleData self, int id)
{
    var sameIdData = Data.Where(v => v != self && v.Id == id).Cast<object>().ToArray();
    if (sameIdData.Any()) return ValidationResult.Error("duplicate ID", sameIdData);
    return ValidationResult.Success();
}
```

#### Example: Duplicate ID Check

`ValidateId` returns an error if another row already uses the same ID.

All table rows are stored in the table's `Data` property. The LINQ query filters out the current row and searches for matching IDs.

Pass the conflicting rows as the second argument to `ValidationResult.Error` so they are highlighted collectively.